<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Ar√®ne - Heroes of Time</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            background: linear-gradient(45deg, #4a90e2, #50c878);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section {
            background: rgba(0, 0, 0, 0.6);
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #4a90e2;
        }
        
        .button {
            background: linear-gradient(45deg, #4a90e2, #6bb6ff);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }
        
        .button.danger {
            background: linear-gradient(45deg, #ff4444, #ff6b6b);
        }
        
        .button.success {
            background: linear-gradient(45deg, #50c878, #7ed321);
        }
        
        .result {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 3px solid #4a90e2;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .heroes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .hero-card {
            background: rgba(74, 144, 226, 0.1);
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .hero-card:hover {
            border-color: #4a90e2;
            transform: translateY(-3px);
        }
        
        .hero-card.selected {
            border-color: #50c878;
            background: rgba(80, 200, 120, 0.2);
        }
        
        .comments-section {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .comment {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #4a90e2;
        }
        
        .comment.urgent {
            border-left-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }
        
        .comment.important {
            border-left-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèüÔ∏è Test API Mode AR√àNE - Heroes of Time</h1>
        
        <!-- Section √âtat de l'Ar√®ne -->
        <div class="section">
            <h2>üåç √âtat du Monde Ar√®ne</h2>
            <button class="button" onclick="getArenaWorld()">R√©cup√©rer l'√âtat</button>
            <button class="button danger" onclick="resetArena()">Reset Ar√®ne</button>
            <div id="worldResult" class="result"></div>
        </div>
        
        <!-- Section H√©ros -->
        <div class="section">
            <h2>ü¶∏ H√©ros Disponibles</h2>
            <button class="button" onclick="getHeroes()">Charger les H√©ros</button>
            <div id="heroesResult" class="result"></div>
            <div id="heroesGrid" class="heroes-grid"></div>
        </div>
        
        <!-- Section Combat -->
        <div class="section">
            <h2>‚öîÔ∏è Gestion des Combats</h2>
            <button class="button success" onclick="startBattle()" id="startBattleBtn">D√©marrer Combat</button>
            <button class="button" onclick="getBattleStatus()">√âtat Combat</button>
            <button class="button danger" onclick="endBattle()">Terminer Combat</button>
            <div id="battleResult" class="result"></div>
            
            <h3>Actions de Combat</h3>
            <button class="button" onclick="executeAction('attack')">‚öîÔ∏è Attaquer</button>
            <button class="button" onclick="executeAction('spell')">üîÆ Sort Temporel</button>
            <button class="button" onclick="executeAction('move')">üèÉ D√©placer</button>
        </div>
        
        <!-- Section Juge -->
        <div class="section">
            <h2>‚öñÔ∏è Le Juge de l'Ar√®ne</h2>
            <button class="button" onclick="getJudgeInfo()">Info Juge</button>
            <button class="button" onclick="getComments()">Commentaires R√©cents</button>
            <button class="button" onclick="toggleJudge()">Toggle Juge</button>
            <div id="judgeResult" class="result"></div>
            <div id="commentsSection" class="comments-section"></div>
        </div>
        
        <!-- Section Statistiques -->
        <div class="section">
            <h2>üìä Statistiques</h2>
            <button class="button" onclick="getStats()">R√©cup√©rer Stats</button>
            <div id="statsResult" class="result"></div>
        </div>
    </div>

    <script>
        let selectedHero = null;
        let currentBattle = null;
        
        // Fonction utilitaire pour afficher les r√©sultats
        function displayResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.style.borderLeftColor = isError ? '#ff4444' : '#4a90e2';
        }
        
        // API Monde Ar√®ne
        async function getArenaWorld() {
            try {
                const response = await fetch('/api/arena/world');
                const data = await response.json();
                displayResult('worldResult', data);
            } catch (error) {
                displayResult('worldResult', { error: error.message }, true);
            }
        }
        
        async function resetArena() {
            try {
                const response = await fetch('/api/arena/world/reset', { method: 'POST' });
                const data = await response.json();
                displayResult('worldResult', data);
                selectedHero = null;
                currentBattle = null;
                updateUI();
            } catch (error) {
                displayResult('worldResult', { error: error.message }, true);
            }
        }
        
        // API H√©ros
        async function getHeroes() {
            try {
                const response = await fetch('/api/arena/heroes');
                const data = await response.json();
                displayResult('heroesResult', data);
                displayHeroesGrid(data);
            } catch (error) {
                displayResult('heroesResult', { error: error.message }, true);
            }
        }
        
        function displayHeroesGrid(heroes) {
            const grid = document.getElementById('heroesGrid');
            grid.innerHTML = '';
            
            heroes.forEach(hero => {
                const card = document.createElement('div');
                card.className = 'hero-card';
                card.innerHTML = `
                    <div><strong>${hero.name}</strong></div>
                    <div>Faction: ${hero.faction}</div>
                    <div>Niveau: ${hero.level}</div>
                    <div>Sort: ${hero.availableSpell}</div>
                    <div>‚ù§Ô∏è${hero.stats.health} üî∑${hero.stats.mana} ‚öîÔ∏è${hero.stats.attack}</div>
                `;
                card.onclick = () => selectHero(hero, card);
                grid.appendChild(card);
            });
        }
        
        async function selectHero(hero, cardElement) {
            try {
                const response = await fetch('/api/arena/heroes/select', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ heroId: hero.id, playerId: 'test_player' })
                });
                
                if (response.ok) {
                    selectedHero = hero;
                    
                    // Mettre √† jour l'UI
                    document.querySelectorAll('.hero-card').forEach(c => c.classList.remove('selected'));
                    cardElement.classList.add('selected');
                    
                    displayResult('heroesResult', { message: `H√©ros s√©lectionn√©: ${hero.name}` });
                    updateUI();
                }
            } catch (error) {
                displayResult('heroesResult', { error: error.message }, true);
            }
        }
        
        // API Combat
        async function startBattle() {
            if (!selectedHero) {
                alert('Veuillez s√©lectionner un h√©ros d\'abord!');
                return;
            }
            
            try {
                const battleConfig = {
                    heroes: [selectedHero],
                    mode: 'CLASSIC',
                    playerId: 'test_player'
                };
                
                const response = await fetch('/api/arena/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(battleConfig)
                });
                
                const data = await response.json();
                displayResult('battleResult', data);
                
                if (response.ok) {
                    currentBattle = data;
                    updateUI();
                    
                    // Afficher le commentaire du juge s'il y en a un
                    if (data.judgeComment) {
                        addComment(data.judgeComment);
                    }
                }
            } catch (error) {
                displayResult('battleResult', { error: error.message }, true);
            }
        }
        
        async function getBattleStatus() {
            try {
                const response = await fetch('/api/arena/status');
                const data = await response.json();
                displayResult('battleResult', data);
            } catch (error) {
                displayResult('battleResult', { error: error.message }, true);
            }
        }
        
        async function endBattle() {
            try {
                const response = await fetch('/api/arena/end', { method: 'POST' });
                const data = await response.json();
                displayResult('battleResult', data);
                
                if (response.ok) {
                    currentBattle = null;
                    updateUI();
                    
                    // Afficher le commentaire du juge s'il y en a un
                    if (data.judgeComment) {
                        addComment(data.judgeComment);
                    }
                }
            } catch (error) {
                displayResult('battleResult', { error: error.message }, true);
            }
        }
        
        async function executeAction(actionType) {
            if (!currentBattle || !selectedHero) {
                alert('Aucun combat en cours ou h√©ros non s√©lectionn√©!');
                return;
            }
            
            try {
                const actionData = {
                    type: actionType,
                    heroId: selectedHero.id,
                    battleId: currentBattle.battleId
                };
                
                const response = await fetch('/api/arena/action', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(actionData)
                });
                
                const data = await response.json();
                displayResult('battleResult', data);
                
                // Afficher le commentaire du juge s'il y en a un
                if (data.judgeComment) {
                    addComment(data.judgeComment);
                }
            } catch (error) {
                displayResult('battleResult', { error: error.message }, true);
            }
        }
        
        // API Juge
        async function getJudgeInfo() {
            try {
                const response = await fetch('/api/arena/judge');
                const data = await response.json();
                displayResult('judgeResult', data);
            } catch (error) {
                displayResult('judgeResult', { error: error.message }, true);
            }
        }
        
        async function getComments() {
            try {
                const response = await fetch('/api/arena/comments?limit=10');
                const data = await response.json();
                displayResult('judgeResult', data);
                displayComments(data);
            } catch (error) {
                displayResult('judgeResult', { error: error.message }, true);
            }
        }
        
        async function toggleJudge() {
            try {
                const response = await fetch('/api/arena/judge/toggle', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ active: true })
                });
                const data = await response.json();
                displayResult('judgeResult', data);
            } catch (error) {
                displayResult('judgeResult', { error: error.message }, true);
            }
        }
        
        function displayComments(comments) {
            const section = document.getElementById('commentsSection');
            section.innerHTML = '';
            
            comments.forEach(comment => {
                const div = document.createElement('div');
                div.className = `comment ${comment.priority?.toLowerCase() || 'normal'}`;
                div.innerHTML = `
                    <div><strong>${comment.sourceName}:</strong></div>
                    <div>${comment.text}</div>
                    <div style="font-size: 0.8em; color: #888; text-align: right;">
                        ${new Date(comment.timestamp).toLocaleTimeString()}
                    </div>
                `;
                section.appendChild(div);
            });
        }
        
        function addComment(comment) {
            const section = document.getElementById('commentsSection');
            const div = document.createElement('div');
            div.className = `comment ${comment.priority?.toLowerCase() || 'normal'}`;
            div.innerHTML = `
                <div><strong>${comment.sourceName}:</strong></div>
                <div>${comment.text}</div>
                <div style="font-size: 0.8em; color: #888; text-align: right;">
                    ${new Date(comment.timestamp).toLocaleTimeString()}
                </div>
            `;
            section.insertBefore(div, section.firstChild);
        }
        
        // API Stats
        async function getStats() {
            try {
                const response = await fetch('/api/arena/stats');
                const data = await response.json();
                displayResult('statsResult', data);
            } catch (error) {
                displayResult('statsResult', { error: error.message }, true);
            }
        }
        
        // Mise √† jour de l'UI
        function updateUI() {
            const startBtn = document.getElementById('startBattleBtn');
            startBtn.textContent = currentBattle ? 'Combat en cours...' : 'D√©marrer Combat';
            startBtn.disabled = !!currentBattle;
        }
        
        // Initialisation
        window.addEventListener('load', () => {
            console.log('üèüÔ∏è Test Arena API charg√©!');
            getArenaWorld();
            getHeroes();
            getJudgeInfo();
        });
    </script>
</body>
</html>