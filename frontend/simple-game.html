<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heroes of Time - Mode Simple</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #00d4ff;
        }

        .game-area {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            margin-top: 20px;
        }

        .panel {
            background: #16213e;
            border: 2px solid #0f3460;
            border-radius: 10px;
            padding: 15px;
        }

        .panel h3 {
            margin-top: 0;
            color: #00d4ff;
            border-bottom: 1px solid #0f3460;
            padding-bottom: 10px;
        }

        /* Grille simple */
        #gameGrid {
            display: grid;
            grid-template-columns: repeat(20, 30px);
            grid-template-rows: repeat(20, 30px);
            gap: 1px;
            background: #0f3460;
            padding: 10px;
            justify-content: center;
        }

        .cell {
            background: #1a1a2e;
            border: 1px solid #2a2a3e;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
        }

        .cell:hover {
            background: #2a2a3e;
        }

        .cell.selected {
            background: #00d4ff33;
            border-color: #00d4ff;
        }

        /* H√©ros et entit√©s */
        .hero {
            color: #ffd700;
        }

        .creature {
            color: #ff6b6b;
        }

        .artifact {
            color: #da70d6;
        }

        .psi-state {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
            color: #ff00ff;
        }

        /* Scripts rapides */
        .quick-script {
            background: #0f3460;
            border: 1px solid #00d4ff;
            color: white;
            padding: 8px 12px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 12px;
        }

        .quick-script:hover {
            background: #00d4ff;
            color: #0f3460;
        }

        /* Console simple */
        #console {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 10px;
            height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        #scriptInput {
            width: 100%;
            padding: 10px;
            background: #0f3460;
            border: 1px solid #00d4ff;
            color: white;
            font-family: monospace;
            margin-top: 10px;
        }

        #executeBtn {
            background: #00d4ff;
            color: #0f3460;
            border: none;
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }

        #executeBtn:hover {
            background: #00a8cc;
        }

        /* Info panel */
        .info-item {
            margin: 5px 0;
            padding: 5px;
            background: #0f3460;
            border-radius: 3px;
        }

        .turn-controls {
            text-align: center;
            margin: 20px 0;
        }

        .turn-btn {
            background: #ffd700;
            color: #0f3460;
            border: none;
            padding: 10px 30px;
            margin: 0 10px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            font-size: 16px;
        }

        .turn-btn:hover {
            background: #ffed4e;
        }

        .status {
            text-align: center;
            padding: 10px;
            background: #0f3460;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Heroes of Time - Mode Simple üéÆ</h1>
        
        <div class="status">
            <span>Tour: <strong id="turnCount">1</strong></span> | 
            <span>Joueur: <strong id="currentPlayer">Player 1</strong></span> |
            <span>Game ID: <strong id="gameId">-</strong></span>
        </div>

        <div class="turn-controls">
            <button class="turn-btn" onclick="simpleGame.createGame()">üéÆ Nouvelle Partie</button>
            <button class="turn-btn" onclick="simpleGame.nextTurn()">‚è≠Ô∏è Tour Suivant</button>
            <button class="turn-btn" onclick="simpleGame.refreshState()">üîÑ Rafra√Æchir</button>
        </div>

        <div class="game-area">
            <!-- Panneau gauche - H√©ros et Info -->
            <div class="panel">
                <h3>ü¶∏ H√©ros</h3>
                <div id="heroesList"></div>
                
                <h3 style="margin-top: 20px;">‚ö° Scripts Rapides</h3>
                <button class="quick-script" onclick="simpleGame.quickScript('HERO(Arthur)')">
                    Cr√©er Arthur
                </button>
                <button class="quick-script" onclick="simpleGame.quickScript('HERO(Morgana)')">
                    Cr√©er Morgana
                </button>
                <button class="quick-script" onclick="simpleGame.quickScript('CREATE(CREATURE, Dragon, @10,10)')">
                    Dragon @10,10
                </button>
                <button class="quick-script" onclick="simpleGame.quickScript('œà001: ‚äô(Œît+2 @5,5 ‚ü∂ CREATE(CREATURE, Goblin, @5,5))')">
                    œà-State Goblin
                </button>
                <button class="quick-script" onclick="simpleGame.quickScript('‚Ä†œà001')">
                    Collapse œà001
                </button>
            </div>

            <!-- Panneau central - Grille -->
            <div class="panel">
                <h3>üó∫Ô∏è Plateau de Jeu (cliquez pour s√©lectionner)</h3>
                <div id="gameGrid"></div>
                <div style="margin-top: 10px; text-align: center;">
                    <small>Position s√©lectionn√©e: <span id="selectedPos">-</span></small>
                </div>
            </div>

            <!-- Panneau droit - œà-States et Artifacts -->
            <div class="panel">
                <h3>üåÄ œà-States Actifs</h3>
                <div id="psiStatesList"></div>
                
                <h3 style="margin-top: 20px;">‚ú® Artifacts</h3>
                <div id="artifactsList">
                    <div class="info-item">Aucun artifact</div>
                </div>
            </div>
        </div>

        <!-- Console en bas -->
        <div class="panel" style="margin-top: 20px;">
            <h3>üìù Console de Script</h3>
            <div id="console"></div>
            <input type="text" id="scriptInput" placeholder="Entrez une commande... Ex: MOV(Arthur, @5,5)" />
            <button id="executeBtn" onclick="simpleGame.executeScript()">Ex√©cuter</button>
        </div>
    </div>

    <script>
        // Game state simple
        const simpleGame = {
            gameId: null,
            selectedCell: null,
            entities: new Map(), // position -> entity
            psiStates: [],
            
            init() {
                this.createGrid();
                this.setupEventListeners();
                this.log('üéÆ Interface simple Heroes of Time charg√©e!', 'info');
                this.log('üí° Cr√©ez une partie pour commencer', 'info');
            },

            createGrid() {
                const grid = document.getElementById('gameGrid');
                grid.innerHTML = '';
                
                for (let y = 0; y < 20; y++) {
                    for (let x = 0; x < 20; x++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.dataset.x = x;
                        cell.dataset.y = y;
                        cell.onclick = () => this.selectCell(x, y);
                        grid.appendChild(cell);
                    }
                }
            },

            selectCell(x, y) {
                // Retirer ancienne s√©lection
                document.querySelectorAll('.cell.selected').forEach(c => c.classList.remove('selected'));
                
                // Nouvelle s√©lection
                const cell = document.querySelector(`[data-x="${x}"][data-y="${y}"]`);
                cell.classList.add('selected');
                this.selectedCell = { x, y };
                
                document.getElementById('selectedPos').textContent = `@${x},${y}`;
                
                // Si un h√©ros est s√©lectionn√©, proposer de le d√©placer
                const entity = this.entities.get(`${x},${y}`);
                if (entity && entity.type === 'hero') {
                    document.getElementById('scriptInput').value = `MOV(${entity.name}, @X,Y)`;
                }
            },

            async createGame() {
                try {
                    const response = await fetch('http://localhost:8080/api/temporal-engine/games', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ gameName: 'Simple Game ' + Date.now() })
                    });
                    
                    if (!response.ok) throw new Error('Failed to create game');
                    
                    const data = await response.json();
                    this.gameId = data.gameId;
                    document.getElementById('gameId').textContent = this.gameId;
                    
                    this.log('‚úÖ Partie cr√©√©e! ID: ' + this.gameId, 'success');
                    this.clearGrid();
                    
                } catch (error) {
                    this.log('‚ùå Erreur: ' + error.message, 'error');
                    // Mode d√©mo si pas de backend
                    this.gameId = 'DEMO-' + Date.now();
                    document.getElementById('gameId').textContent = this.gameId;
                    this.log('üéÆ Mode d√©mo activ√© (pas de backend)', 'info');
                }
            },

            async executeScript() {
                const script = document.getElementById('scriptInput').value.trim();
                if (!script) return;
                
                this.log('> ' + script, 'command');
                
                if (!this.gameId) {
                    this.log('‚ùå Cr√©ez d\'abord une partie!', 'error');
                    return;
                }

                // Mode d√©mo
                if (this.gameId.startsWith('DEMO-')) {
                    this.executeDemoScript(script);
                    return;
                }

                try {
                    const response = await fetch(`http://localhost:8080/api/temporal-engine/games/${this.gameId}/script`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ script })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.log('‚úÖ Script ex√©cut√©!', 'success');
                        this.refreshState();
                    } else {
                        this.log('‚ùå ' + result.error, 'error');
                    }
                    
                } catch (error) {
                    this.log('‚ùå Erreur r√©seau: ' + error.message, 'error');
                }
                
                document.getElementById('scriptInput').value = '';
            },

            executeDemoScript(script) {
                // Simulation simple pour le mode d√©mo
                if (script.startsWith('HERO(')) {
                    const name = script.match(/HERO\(([^)]+)\)/)[1];
                    this.addEntity(5, 5, { type: 'hero', name, icon: 'ü¶∏' });
                    this.log(`‚úÖ H√©ros ${name} cr√©√©!`, 'success');
                } else if (script.startsWith('MOV(')) {
                    const match = script.match(/MOV\(([^,]+),\s*@(\d+),(\d+)\)/);
                    if (match) {
                        const [_, hero, x, y] = match;
                        this.moveHero(hero, parseInt(x), parseInt(y));
                    }
                } else if (script.startsWith('CREATE(')) {
                    const match = script.match(/CREATE\(([^,]+),\s*([^,]+),\s*@(\d+),(\d+)\)/);
                    if (match) {
                        const [_, type, name, x, y] = match;
                        const icon = type === 'CREATURE' ? 'üêâ' : 'üì¶';
                        this.addEntity(parseInt(x), parseInt(y), { type: type.toLowerCase(), name, icon });
                        this.log(`‚úÖ ${name} cr√©√© en @${x},${y}!`, 'success');
                    }
                } else if (script.includes('œà')) {
                    this.psiStates.push(script);
                    this.updatePsiStatesList();
                    this.log('‚úÖ œà-state cr√©√©!', 'success');
                } else if (script.startsWith('‚Ä†')) {
                    this.psiStates = this.psiStates.filter(s => !s.includes(script.substring(1)));
                    this.updatePsiStatesList();
                    this.log('üí• Collapse effectu√©!', 'success');
                }
            },

            moveHero(heroName, x, y) {
                // Trouver le h√©ros
                for (const [pos, entity] of this.entities) {
                    if (entity.type === 'hero' && entity.name === heroName) {
                        this.entities.delete(pos);
                        this.addEntity(x, y, entity);
                        this.log(`‚úÖ ${heroName} d√©plac√© en @${x},${y}!`, 'success');
                        break;
                    }
                }
            },

            addEntity(x, y, entity) {
                const key = `${x},${y}`;
                this.entities.set(key, entity);
                this.updateGrid();
                this.updateHeroesList();
            },

            updateGrid() {
                // Clear all cells
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.innerHTML = '';
                });
                
                // Add entities
                for (const [pos, entity] of this.entities) {
                    const [x, y] = pos.split(',').map(n => parseInt(n));
                    const cell = document.querySelector(`[data-x="${x}"][data-y="${y}"]`);
                    if (cell) {
                        cell.innerHTML = entity.icon || '?';
                    }
                }
            },

            updateHeroesList() {
                const list = document.getElementById('heroesList');
                const heroes = Array.from(this.entities.values()).filter(e => e.type === 'hero');
                
                if (heroes.length === 0) {
                    list.innerHTML = '<div class="info-item">Aucun h√©ros</div>';
                } else {
                    list.innerHTML = heroes.map(hero => {
                        const pos = Array.from(this.entities.entries()).find(([_, e]) => e === hero)?.[0];
                        return `<div class="info-item">${hero.icon} ${hero.name} - @${pos || '?,?'}</div>`;
                    }).join('');
                }
            },

            updatePsiStatesList() {
                const list = document.getElementById('psiStatesList');
                if (this.psiStates.length === 0) {
                    list.innerHTML = '<div class="info-item">Aucun œà-state</div>';
                } else {
                    list.innerHTML = this.psiStates.map(psi => 
                        `<div class="info-item">üåÄ ${psi.substring(0, 30)}...</div>`
                    ).join('');
                }
            },

            async nextTurn() {
                if (!this.gameId || this.gameId.startsWith('DEMO-')) {
                    const turn = parseInt(document.getElementById('turnCount').textContent) + 1;
                    document.getElementById('turnCount').textContent = turn;
                    this.log(`üîÑ Tour ${turn}`, 'info');
                    return;
                }

                try {
                    const response = await fetch(`http://localhost:8080/api/temporal-engine/games/${this.gameId}/turn`, {
                        method: 'POST'
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        document.getElementById('turnCount').textContent = result.currentTurn || '?';
                        this.log('üîÑ Tour suivant!', 'success');
                        this.refreshState();
                    }
                } catch (error) {
                    this.log('‚ùå Erreur: ' + error.message, 'error');
                }
            },

            async refreshState() {
                if (!this.gameId || this.gameId.startsWith('DEMO-')) return;
                
                try {
                    const response = await fetch(`http://localhost:8080/api/temporal-engine/games/${this.gameId}/state`);
                    const state = await response.json();
                    
                    // Update UI with state
                    document.getElementById('turnCount').textContent = state.currentTurn || '1';
                    
                    // TODO: Update grid with actual game state
                    
                } catch (error) {
                    console.error('Failed to refresh state:', error);
                }
            },

            clearGrid() {
                this.entities.clear();
                this.psiStates = [];
                this.updateGrid();
                this.updateHeroesList();
                this.updatePsiStatesList();
            },

            quickScript(script) {
                document.getElementById('scriptInput').value = script;
                this.executeScript();
            },

            log(message, type = 'normal') {
                const console = document.getElementById('console');
                const line = document.createElement('div');
                line.style.color = {
                    'info': '#00d4ff',
                    'success': '#44ff44',
                    'error': '#ff4444',
                    'command': '#ffd700',
                    'normal': '#ffffff'
                }[type];
                line.textContent = message;
                console.appendChild(line);
                console.scrollTop = console.scrollHeight;
            },

            setupEventListeners() {
                document.getElementById('scriptInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.executeScript();
                    }
                });
            }
        };

        // Initialize on load
        window.onload = () => simpleGame.init();
    </script>
</body>
</html>