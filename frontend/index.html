<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heroes of Time - Temporal Engine</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="responsive-1280x800.css">
    <link rel="stylesheet" href="layout-fix.css">
    <link rel="stylesheet" href="temporal-styles.css">
    <link rel="stylesheet" href="translation-styles.css">
    <link rel="stylesheet" href="styles/city.css">
    <link rel="stylesheet" href="styles/combat.css">
    <link rel="stylesheet" href="styles/hero.css">
    <link rel="stylesheet" href="styles/dicebear.css">
    <link rel="stylesheet" href="styles/scenario-selector.css">
    <link rel="stylesheet" href="event-log-styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="title">ğŸ•°ï¸ Heroes of Time - Temporal Engine</div>
            <div class="controls">
                <button id="new-game-btn" class="btn-primary">ğŸ® New Game</button>
                <button id="city-btn" class="btn-primary">ğŸ›ï¸ Ville</button>
                <button id="combat-btn" class="btn-primary">âš”ï¸ Combat</button>
                <button id="hero-btn" class="btn-primary">ğŸ‘¤ HÃ©ros</button>
                <button id="joint-magic-btn" class="btn-warning">ğŸš¬ Joint Magique</button>
                <button id="scenario-btn" class="btn-primary">ğŸ“‹ ScÃ©narios</button>
                <button id="grofi-heroes-btn" class="btn-primary">ğŸŒŸ HÃ©ros GROFI</button>
                <button id="add-ragnar-btn" class="btn-secondary">ğŸ›¡ï¸ Add Ragnar</button>
                <button id="test-decay-btn" class="btn-warning">â° Test Decay</button>
                <button id="dicebear-gallery-btn" class="btn-info">ğŸ¦¸ HÃ©ros Gallery</button>
                <button id="settings-btn" class="btn-icon">âš™ï¸</button>
                
                <!-- ğŸŒ«ï¸ ZFC CONTROLS IN HEADER -->
                <div id="fog-controls-header"></div>
            </div>
        </header>
        
        <div class="game-area">
            <div class="game-board">
                <canvas id="game-canvas"></canvas>
                <div class="game-overlay">
                    <div class="temporal-info" id="temporal-info">
                        <div class="info-card">
                            <h3>â° Temporal Status</h3>
                            <div id="current-timeline">Timeline: â„¬1</div>
                            <div id="current-turn">Turn: 0</div>
                            <div id="decay-status">Decay: None</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="side-panel">
                <!-- ğŸ® ContrÃ´les Principaux -->
                <div class="main-controls">
                    <div class="control-section">
                        <h3>ğŸ® ContrÃ´les Principaux</h3>
                        <div class="control-buttons">
                            <button id="hero-select-btn" class="btn-control">ğŸ‘ï¸ SÃ©lectionner HÃ©ros</button>
                            <button id="move-btn" class="btn-control">ğŸš¶ DÃ©placer</button>
                            <button id="attack-btn" class="btn-control">âš”ï¸ Attaquer</button>
                            <button id="explore-btn" class="btn-control">ğŸ—ºï¸ Explorer</button>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <h3>ğŸ”® Actions Temporelles</h3>
                        <div class="control-buttons">
                            <button id="psi-create-btn" class="btn-control">Ïˆ CrÃ©er Ã‰tat</button>
                            <button id="psi-collapse-btn" class="btn-control">â€  Effondrer</button>
                            <button id="timeline-switch-btn" class="btn-control">ğŸ”„ Changer Timeline</button>
                        </div>
                    </div>
                </div>
                
                <div class="script-console" id="script-console">
                    <!-- Console will be populated by JavaScript -->
                </div>
                
                <div class="hero-panel" id="hero-panel">
                    <h3>ğŸ¦¸ Heroes</h3>
                    <div id="heroes-list"></div>
                </div>
                
                <div class="psi-panel" id="psi-panel">
                    <h3>ğŸ”® Ã‰tats Ïˆ</h3>
                    <div id="psi-states-list"></div>
                </div>
            </div>
        </div>
        
        <div class="status-bar" id="status-bar">
            âš¡ HEROES OF TIME ENGINE - Initializing temporal systems...
        </div>
        
        <!-- ğŸ® Bouton d'ouverture du sÃ©lecteur de scÃ©narios -->
        <button id="open-scenario-selector-btn" class="scenario-selector-btn">
            ğŸ® ScÃ©narios
        </button>

        <!-- Dicebear Gallery Modal -->
        <div id="dicebear-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ğŸ­ Dicebear Graphics Gallery</h2>
                    <span class="close" id="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="dicebear-gallery"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="api.js"></script>
    <script src="translation-service.js"></script>
    <script src="components/CityInterface.js"></script>
    <script src="components/CombatInterface.js"></script>
    <script src="components/HeroInterface.js"></script>
    <script src="script-console.js"></script>
    <script src="game.js"></script>
    <script src="runic-forge.js"></script>
    <script src="temporal-integration.js"></script>
    <script src="hero-avatars.js"></script>
    <script src="scenario-selector.js"></script>
    <script src="gameplay-enhancement.js"></script>
    <script src="missing-assets-loader.js"></script>
    <script src="gameplay-construction.js"></script>
    <script src="fog-of-war-system.js"></script>
    <script src="runic-symbols-port8000.js"></script>
    <script src="conflict-detection-fusion.js"></script>
    <script src="websocket-handler-zfc.js"></script>
    <script src="trinity-cosmique-service.js"></script>
    <script src="timeline-transparency-manager.js"></script>
    <script src="coordinate-fix.js"></script>
    <script src="ui-emergency-fix.js"></script>
    <script src="canvas-hero-renderer.js"></script>
    <script src="json-icon-system.js"></script>
    <script src="timeline-diodes-system.js"></script>
    <script src="system-messages.js"></script>
    <script src="contextual-hero-actions.js"></script>
    <script>
        // Initialize the comprehensive dicebar graphics system
        // JSON Icon System loaded automatically
        
        // ğŸŒ«ï¸ Initialiser le systÃ¨me de brouillard de causalitÃ©
        window.fogOfWarSystem = new FogOfWarSystem();
        const fogControlsContainer = document.getElementById('fog-controls-header');
        if (fogControlsContainer) {
            fogControlsContainer.appendChild(window.fogOfWarSystem.createFogControls());
        }
        
        // ğŸ›ï¸ Ã‰vÃ©nements pour l'interface de ville
        document.getElementById('city-btn').addEventListener('click', () => {
            window.cityInterface.toggle();
        });
        
        // âš”ï¸ Ã‰vÃ©nements pour l'interface de combat
        document.getElementById('combat-btn').addEventListener('click', () => {
            window.combatInterface.toggle();
        });
        
        // ğŸ‘¤ Ã‰vÃ©nements pour l'interface de hÃ©ros
        document.getElementById('hero-btn').addEventListener('click', () => {
            window.heroInterface.toggle();
        });
        
        // ğŸš¬ Ã‰vÃ©nements pour le Joint Magique
        document.getElementById('joint-magic-btn').addEventListener('click', () => {
            window.open('frontend/joint-panopticon-interface.html', '_blank', 'width=1200,height=800');
        });
        
        // ğŸ“‹ Ã‰vÃ©nements pour le sÃ©lecteur de scÃ©narios
        document.getElementById('scenario-btn').addEventListener('click', () => {
            if (window.scenarioSelector) {
                window.scenarioSelector.show();
            }
        });
        
        // ğŸŒ Initialiser le service de traduction
        window.translationService = new TranslationService();
        
        // ğŸ® Initialiser l'API de jeu
        window.gameAPI = new GameAPI();
        
        // ğŸ›ï¸ Initialiser l'interface de ville
        window.cityInterface = new CityInterface();
        
        // âš”ï¸ Initialiser l'interface de combat
        window.combatInterface = new CombatInterface();
        
        // ğŸ‘¤ Initialiser l'interface de hÃ©ros
        window.heroInterface = new HeroInterface();
        
        // ğŸ® Initialiser le sÃ©lecteur de scÃ©narios
        window.scenarioSelector = new ScenarioSelector();
        const openScenarioBtn = document.getElementById('open-scenario-selector-btn');
        if (openScenarioBtn) {
            openScenarioBtn.addEventListener('click', () => {
                window.scenarioSelector.show();
            });
        }
        
        // Initialize game components
        let gameRenderer;
        let gameState = {
            heroes: [],
            creatures: [],
            artifacts: [],
            currentTimeline: 'â„¬1',
            currentTurn: 0,
            decayStatus: 'None'
        };

        // Mock heroes with dicebar graphics
        window.createMockHeroes = function() {
            const mockHeroes = [
                {
                    name: 'Ragnar',
                    health: 120,
                    maxHealth: 120,
                    temporalEnergy: 80,
                    movementPoints: 3,
                    timeline: 'â„¬1',
                    position: { q: 0, r: 0 }
                },
                {
                    name: 'Arthur',
                    health: 100,
                    maxHealth: 100,
                    temporalEnergy: 60,
                    movementPoints: 2,
                    timeline: 'â„¬1',
                    position: { q: 1, r: -1 }
                },
                {
                    name: 'Jean-Grofignon',
                    health: 80,
                    maxHealth: 80,
                    temporalEnergy: 120,
                    movementPoints: 2,
                    timeline: 'â„¬1',
                    position: { q: -1, r: 1 }
                }
            ];
            
            gameState.heroes = mockHeroes;
            window.updateHeroesList(mockHeroes);
            window.updateStatusBar('Demo Heroes: Ragnar ğŸ›¡ï¸, Arthur âš”ï¸, and Jean-Grofignon ğŸ§  ready with Dicebear graphics!');
        };

        // Enhanced heroes list with dicebar graphics
        window.updateHeroesList = function(heroes) {
            const heroesList = document.getElementById('heroes-list');
            if (!heroesList) return;
            
            heroesList.innerHTML = '';
            heroes.forEach(hero => {
                const heroElement = document.createElement('div');
                heroElement.className = 'hero-item enhanced-hero-item';
                
                // Create dicebar avatar for the hero
                const avatarElement = dicebarSystem.createAvatarElement('hero', hero.name, 50);
                
                heroElement.innerHTML = `
                    <div class="hero-header">
                        <div class="hero-avatar-container"></div>
                        <div class="hero-info">
                            <div class="hero-name">${hero.name}</div>
                            <div class="hero-stats">
                                <span class="health">â¤ï¸ ${hero.health}/${hero.maxHealth}</span>
                                <span class="energy">âš¡ ${hero.temporalEnergy}</span>
                                <span class="movement">ğŸ‘Ÿ ${hero.movementPoints}</span>
                            </div>
                        </div>
                    </div>
                    <div class="hero-timeline">â° ${hero.timeline}</div>
                `;
                
                // Insert the dicebar avatar
                const avatarContainer = heroElement.querySelector('.hero-avatar-container');
                avatarContainer.appendChild(avatarElement);
                
                heroesList.appendChild(heroElement);
            });
        };

        // Dicebear Gallery functionality
        document.getElementById('dicebear-gallery-btn').addEventListener('click', function() {
            const modal = document.getElementById('dicebear-modal');
            modal.style.display = 'block';
            
            // Create the gallery
            window.jsonIconSystem.createSimpleGallery('dicebear-gallery');
        });

        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('dicebear-modal').style.display = 'none';
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('dicebear-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize canvas renderer
            gameRenderer = new GameRenderer('game-canvas');
            
            // Initialize script console
            if (typeof ScriptConsole !== 'undefined') {
                window.scriptConsole = new ScriptConsole('script-console');
                window.scriptConsole.addToOutput('ğŸ•°ï¸ Heroes of Time - Temporal Engine with Enhanced Dicebear Graphics', 'success');
                window.scriptConsole.addToOutput('Available commands:', 'normal');
                window.scriptConsole.addToOutput('  â€¢ HERO(Ragnar) - Create hero with dicebear avatar', 'normal');
                window.scriptConsole.addToOutput('  â€¢ MOV(Ragnar, @5,3) - Move hero', 'normal');
                window.scriptConsole.addToOutput('  â€¢ CREATURE(Dragon Rouge Temporel) - Summon creature with graphics', 'normal');
                window.scriptConsole.addToOutput('  â€¢ ARTIFACT(avantworld_blade) - Create artifact with graphics', 'normal');
                window.scriptConsole.addToOutput('ğŸ­ Click "Dicebear Gallery" to see all available graphics!', 'info');
            }

            // Load demo heroes with dicebar graphics
            setTimeout(() => {
                window.scriptConsole.addToOutput('ğŸ­ Loading heroes with dicebear graphics for immediate testing...', 'info');
                window.createMockHeroes();
            }, 1000);

            // Initialize other game systems
            if (typeof initializeGameSystems === 'function') {
                initializeGameSystems();
            }
        });

        // Enhanced button handlers with dicebar integration
        document.getElementById('new-game-btn').addEventListener('click', async function() {
            try {
                const result = await window.gameAPI.newGame();
                window.scriptConsole.addToOutput('ğŸ® New game started with dicebear graphics!', 'success');
                window.createMockHeroes(); // Load heroes with graphics
            } catch (error) {
                window.scriptConsole.addToOutput('âš ï¸ Backend not available, using demo mode with graphics', 'warning');
                window.createMockHeroes();
            }
        });

        document.getElementById('add-ragnar-btn').addEventListener('click', async function() {
            try {
                const result = await window.gameAPI.executeScript('HERO(Ragnar)');
                window.scriptConsole.addToOutput('ğŸ›¡ï¸ Hero Ragnar created with dicebear graphics via temporal script!', 'success');
                window.updateHeroesList(result.heroes || []);
            } catch (error) {
                window.scriptConsole.addToOutput('âš ï¸ Backend not available for script execution', 'warning');
                window.scriptConsole.addToOutput('ğŸ­ Loading demo heroes with graphics instead...', 'info');
                window.createMockHeroes();
            }
        });

        document.getElementById('grofi-heroes-btn').addEventListener('click', async function() {
            try {
                // CrÃ©er les hÃ©ros GROFI lÃ©gendaires
                const grofiHeroes = [
                    'HERO(Jean-Grofignon)',
                    'HERO(Walter Sobchak)', 
                    'HERO(The Dude)',
                    'HERO(Vince Vega)',
                    'HERO(Anna Martel)'
                ];
                
                for (const heroScript of grofiHeroes) {
                    const result = await window.gameAPI.executeScript(heroScript);
                    window.scriptConsole.addToOutput(`ğŸŒŸ ${heroScript} - HÃ©ros GROFI crÃ©Ã©!`, 'success');
                }
                
                window.scriptConsole.addToOutput('ğŸŒŸ Tous les Compagnons GROFI sont maintenant disponibles!', 'success');
                window.scriptConsole.addToOutput('ğŸ­ Utilisez MOV(), CAST(), USE() avec ces hÃ©ros lÃ©gendaires', 'info');
                
            } catch (error) {
                window.scriptConsole.addToOutput('âš ï¸ Backend not available, crÃ©ation des hÃ©ros GROFI en mode dÃ©mo', 'warning');
                window.scriptConsole.addToOutput('ğŸŒŸ Jean-Grofignon, Walter Sobchak, The Dude, Vince Vega crÃ©Ã©s!', 'success');
                window.createMockHeroes();
            }
        });

        document.getElementById('test-decay-btn').addEventListener('click', async function() {
            try {
                const result = await window.gameAPI.testDecay();
                window.scriptConsole.addToOutput('â° Temporal decay test executed', 'success');
                if (result.decayStatus) {
                    document.getElementById('decay-status').textContent = `Decay: ${result.decayStatus}`;
                }
            } catch (error) {
                window.scriptConsole.addToOutput('âš ï¸ Backend not available for decay testing', 'warning');
                document.getElementById('decay-status').textContent = 'Decay: Demo Mode';
            }
        });

        // Status bar update function
        window.updateStatusBar = function(message) {
            if (window.scriptConsole) {
                window.scriptConsole.addToOutput(message, 'info');
            }
        };

        // Global game state access
        window.getGameState = function() {
            return gameState;
        };

        window.updateGameState = function(newState) {
            gameState = { ...gameState, ...newState };
            if (gameRenderer) {
                gameRenderer.updateGameState(gameState);
            }
        };

        // Export dicebar system for global access
        window.dicebarSystem = dicebarSystem;
        
        // âœ¨ AUTO-DEMO DETECTION & REPLAY SYSTEM âœ¨
        // =======================================
        
        // Fonction pour dÃ©tecter les paramÃ¨tres URL
        function checkAutoDemo() {
            const urlParams = new URLSearchParams(window.location.search);
            const demoMode = urlParams.get('demo');
            const scenario = urlParams.get('scenario');
            
            if (demoMode === 'auto' && scenario === 'zfc') {
                console.log('ğŸ® AUTO-DEMO ZFC DÃ‰TECTÃ‰ - Lancement automatique...');
                window.updateStatusBar('ğŸ® AUTO-DEMO ZFC ACTIVÃ‰');
                setTimeout(startZFCAutoDemo, 2000); // Attendre 2 sec que tout soit chargÃ©
            }
        }
        
        // Fonction pour lancer la dÃ©mo ZFC automatique
        async function startZFCAutoDemo() {
            window.updateStatusBar('ğŸš€ DÃ‰MARRAGE DÃ‰MO ZFC - Mode Auto-Replay');
            
            // CrÃ©er les hÃ©ros GROFI pour la dÃ©mo - POSITIONS CENTRÃ‰ES
            const demoHeroes = [
                { name: 'Arthur', icon: 'ğŸ‘‘', x: 250, y: 200, color: '#4ECDC4' },
                { name: 'Morgana', icon: 'ğŸ§™â€â™€ï¸', x: 350, y: 180, color: '#FF6B6B' },
                { name: 'Lysandrel', icon: 'ğŸ§â€â™‚ï¸', x: 300, y: 250, color: '#45B7D1' },
                { name: 'Ragnar', icon: 'ğŸ›¡ï¸', x: 200, y: 220, color: '#FFA726' }
            ];
            
            // Ajouter les hÃ©ros Ã  la map
            demoHeroes.forEach(hero => {
                createHeroOnMap(hero);
            });
            
            window.updateStatusBar('ğŸ‘¥ 4 hÃ©ros crÃ©Ã©s pour la dÃ©mo ZFC');
            
            // Lancer les phases avec bulles de dialogue
            setTimeout(() => startZFCPhases(demoHeroes), 1000);
        }
        
        // CrÃ©er un hÃ©ros sur la map avec icÃ´ne
        function createHeroOnMap(hero) {
            const canvas = document.getElementById('game-canvas');
            const rect = canvas.getBoundingClientRect();
            
            // CrÃ©er l'Ã©lÃ©ment hÃ©ros
            const heroElement = document.createElement('div');
            heroElement.className = 'demo-hero';
            heroElement.id = `hero-${hero.name}`;
            heroElement.innerHTML = `
                <div class="hero-icon">${hero.icon}</div>
                <div class="hero-name">${hero.name}</div>
            `;
            
            heroElement.style.cssText = `
                position: absolute;
                left: ${hero.x}px;
                top: ${hero.y}px;
                text-align: center;
                color: ${hero.color};
                font-weight: bold;
                font-size: 12px;
                z-index: 100;
                transition: all 0.5s ease-in-out;
                cursor: pointer;
            `;
            
            // Ajouter au game-overlay
            const gameOverlay = document.querySelector('.game-overlay');
            gameOverlay.appendChild(heroElement);
            
            // Animation d'apparition
            setTimeout(() => {
                heroElement.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    heroElement.style.transform = 'scale(1)';
                }, 200);
            }, 100);
        }
        
        // CrÃ©er une bulle de dialogue au-dessus d'un hÃ©ros
        function showDialogueBubble(heroName, message, duration = 3000) {
            const heroElement = document.getElementById(`hero-${heroName}`);
            if (!heroElement) return;
            
            // CrÃ©er la bulle
            const bubble = document.createElement('div');
            bubble.className = 'dialogue-bubble';
            bubble.innerHTML = message;
            
            bubble.style.cssText = `
                position: absolute;
                bottom: 100%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 8px 12px;
                border-radius: 12px;
                font-size: 11px;
                white-space: nowrap;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                border: 1px solid #4ECDC4;
                z-index: 200;
                opacity: 0;
                animation: bubbleAppear 0.3s ease-out forwards;
            `;
            
            // Ajouter l'animation CSS
            if (!document.getElementById('bubble-animations')) {
                const style = document.createElement('style');
                style.id = 'bubble-animations';
                style.textContent = `
                    @keyframes bubbleAppear {
                        from { opacity: 0; transform: translateX(-50%) translateY(10px); }
                        to { opacity: 1; transform: translateX(-50%) translateY(-5px); }
                    }
                    @keyframes bubbleDisappear {
                        from { opacity: 1; transform: translateX(-50%) translateY(-5px); }
                        to { opacity: 0; transform: translateX(-50%) translateY(-15px); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            heroElement.appendChild(bubble);
            
            // Supprimer aprÃ¨s durÃ©e
            setTimeout(() => {
                bubble.style.animation = 'bubbleDisappear 0.3s ease-out forwards';
                setTimeout(() => {
                    if (bubble.parentNode) {
                        bubble.parentNode.removeChild(bubble);
                    }
                }, 300);
            }, duration);
        }
        
        // DÃ©placer un hÃ©ros sur la map
        function moveHero(heroName, newX, newY) {
            const heroElement = document.getElementById(`hero-${heroName}`);
            if (!heroElement) return;
            
            heroElement.style.left = newX + 'px';
            heroElement.style.top = newY + 'px';
        }
        
        // Lancer les phases ZFC avec animations et bulles
        async function startZFCPhases(heroes) {
            // PHASE 1: Actions simultanÃ©es
            window.updateStatusBar('âš¡ PHASE 1: Actions simultanÃ©es - 4 zones ZFC');
            
            showDialogueBubble('Arthur', 'âš”ï¸ "Je lance Excalibur Strike!"');
            showDialogueBubble('Morgana', 'ğŸ”® "Invocation du Dragon Noir!"');
            showDialogueBubble('Lysandrel', 'ğŸ¹ "Tir de PrÃ©cision Elfique!"');
            showDialogueBubble('Ragnar', 'ğŸ›¡ï¸ "Charge de Berserker!"');
            
            // Bouger les hÃ©ros
            setTimeout(() => {
                moveHero('Arthur', 150, 120);
                moveHero('Morgana', 350, 140);
                moveHero('Lysandrel', 250, 170);
                moveHero('Ragnar', 450, 150);
            }, 1000);
            
            await new Promise(resolve => setTimeout(resolve, 4000));
            
            // PHASE 2: RÃ©solution des conflits
            window.updateStatusBar('ğŸ›ï¸ PHASE 2: TrinitÃ© Cosmique rÃ©sout les conflits');
            
            showDialogueBubble('Arthur', 'ğŸ¤” "Collision dÃ©tectÃ©e avec Morgana..."');
            showDialogueBubble('Morgana', 'ğŸ’€ "Memento analyse... Duel Ã  mort!"');
            
            await new Promise(resolve => setTimeout(resolve, 3500));
            
            // PHASE 3: Shadow Actions
            window.updateStatusBar('ğŸ‘» PHASE 3: PrÃ©dictions Shadow Actions - 94.3% prÃ©cision');
            
            showDialogueBubble('Lysandrel', 'ğŸ‘» "Je vois 3 futurs possibles..."');
            showDialogueBubble('Ragnar', 'âš¡ "Action fantÃ´me: Coup Critique!"');
            
            // CrÃ©er des effets visuels (ombres)
            heroes.forEach(hero => {
                const shadowHero = document.getElementById(`hero-${hero.name}`).cloneNode(true);
                shadowHero.id = `shadow-${hero.name}`;
                shadowHero.style.opacity = '0.3';
                shadowHero.style.filter = 'blur(1px)';
                shadowHero.style.zIndex = '50';
                document.querySelector('.game-overlay').appendChild(shadowHero);
                
                setTimeout(() => {
                    if (shadowHero.parentNode) shadowHero.parentNode.removeChild(shadowHero);
                }, 2500);
            });
            
            await new Promise(resolve => setTimeout(resolve, 4000));
            
            // PHASE 4: Pathfinding quantique
            window.updateStatusBar('ğŸš€ PHASE 4: Pathfinding Q* - 36.5% succÃ¨s Excalibur');
            
            showDialogueBubble('Arthur', 'ğŸŒŸ "AccÃ¨s Ã  Excalibur via T67!"');
            showDialogueBubble('Morgana', 'ğŸ¯ "Calcul quantique... 36.5%"');
            
            // Animation de tÃ©lÃ©portation quantique
            setTimeout(() => {
                moveHero('Arthur', 300, 80);
                showDialogueBubble('Arthur', 'â­ "TÃ©lÃ©portation quantique!"', 2000);
            }, 1500);
            
            await new Promise(resolve => setTimeout(resolve, 4000));
            
            // PHASE 5: Chaos maximal
            window.updateStatusBar('âš¡ PHASE 5: Chaos maximal - 8 zones actives');
            
            showDialogueBubble('Morgana', 'ğŸ”¥ "CHAOS TEMPOREL MAXIMUM!"');
            showDialogueBubble('Lysandrel', 'ğŸ˜µ "Trop de timelines simultanÃ©es!"');
            showDialogueBubble('Ragnar', 'ğŸ¤ª "Ma hache vibre dans 4 dimensions!"');
            showDialogueBubble('Arthur', 'ğŸ‘‘ "Je maintiens l\'ordre cosmique!"');
            
            // Mouvement chaotique final
            const chaosMovements = [
                () => moveHero('Morgana', 100, 50),
                () => moveHero('Lysandrel', 400, 220),  
                () => moveHero('Ragnar', 180, 180),
                () => moveHero('Arthur', 320, 160)
            ];
            
            chaosMovements.forEach((move, i) => {
                setTimeout(move, i * 500);
            });
            
            await new Promise(resolve => setTimeout(resolve, 5000));
            
            // RÃ‰SULTATS FINAUX
            window.updateStatusBar('ğŸ† RÃ‰SULTATS: Morgana ğŸ¥‡ | Arthur ğŸ¥ˆ | Lysandrel ğŸ¥‰ | Ragnar ğŸ¥´');
            
            showDialogueBubble('Morgana', 'ğŸ† "Victoire! Je rÃ¨gne sur le chaos!"');
            showDialogueBubble('Arthur', 'ğŸ¥ˆ "Bien jouÃ©, Morgana..."');
            showDialogueBubble('Lysandrel', 'ğŸ¥‰ "Prochaine fois je serai prÃªt!"');
            showDialogueBubble('Ragnar', 'ğŸ¥´ "OÃ¹m est passÃ©e ma hache...?"');
            
            setTimeout(() => {
                window.updateStatusBar('âœ… DÃ‰MONSTRATION ZFC TERMINÃ‰E - Performance: 73ms ZFC | 60 FPS');
            }, 3000);
        }
        
        // Lancer la vÃ©rification auto-demo au chargement
        setTimeout(checkAutoDemo, 500);
    </script>
    
    <!-- ğŸŒŸ SYSTÃˆME D'Ã‰VÃ‰NEMENTS INTELLIGENT -->
    <script src="translation-service.js"></script>
    <script src="event-log-system.js"></script>
    <script src="game-event-integration.js"></script>
    <script src="demo-event-system.js"></script>
    
    <!-- ğŸ¨ FORD'S STYLUS OF REALITY - ARTISTIC MESSAGE SYSTEM âœ¨ -->
    <script src="artistic-message-system.js"></script>
    
    <!-- ğŸŒ€âš¡ MATRIX ARCHITECT FUSION - SUPER SAIYAN SYSTEM âš¡ğŸŒ€ -->
    <script src="matrix-architect-fusion.js"></script>
    
    <!-- ğŸŒ€âš¡ THE SOURCE SYSTEM - ULTIMATE REALITY CONTROL âš¡ğŸŒ€ -->
    <script src="the-source-system.js"></script>
    
    <!-- ğŸŒ€âš¡ ZFC COMPLETE SYSTEM - FINAL ENGINE âš¡ğŸŒ€ -->
    <!-- <script src="zfc-complete-system.js"></script> DÃ‰SACTIVÃ‰ - Interface trop intrusive -->
</body>
</html>