<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heroes of Time - Temporal Engine</title>
            <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="temporal-styles.css">
        <link rel="stylesheet" href="translation-styles.css">
        <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="title">üï∞Ô∏è Heroes of Time - Temporal Engine</div>
            <div class="controls">
                <button id="new-game-btn" class="btn-primary">üéÆ New Game</button>
                <button id="add-ragnar-btn" class="btn-secondary">üõ°Ô∏è Add Ragnar</button>
                <button id="test-decay-btn" class="btn-warning">‚è∞ Test Decay</button>
                <button id="dicebear-gallery-btn" class="btn-info">üé≠ Dicebear Gallery</button>
                <button id="settings-btn" class="btn-icon">‚öôÔ∏è</button>
            </div>
        </header>
        
        <div class="game-area">
            <div class="game-board">
                <canvas id="game-canvas"></canvas>
                <div class="game-overlay">
                    <div class="temporal-info" id="temporal-info">
                        <div class="info-card">
                            <h3>‚è∞ Temporal Status</h3>
                            <div id="current-timeline">Timeline: ‚Ñ¨1</div>
                            <div id="current-turn">Turn: 0</div>
                            <div id="decay-status">Decay: None</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="side-panel">
                <!-- üå´Ô∏è Contr√¥les de Brouillard de Guerre -->
                <div id="fog-controls-container"></div>
                
                <div class="script-console" id="script-console">
                    <!-- Console will be populated by JavaScript -->
                </div>
                
                <div class="hero-panel" id="hero-panel">
                    <h3>ü¶∏ Heroes</h3>
                    <div id="heroes-list"></div>
                </div>
                
                <div class="decay-panel" id="decay-panel">
                    <h3>üé≠ Anna's Decay System</h3>
                    <div class="decay-controls">
                        <button id="apply-decay-btn" class="btn-warning">Apply Decay</button>
                        <button id="repair-buildings-btn" class="btn-success">Repair Buildings</button>
                    </div>
                    <div id="decay-stats"></div>
                </div>
            </div>
        </div>
        
        <div class="status-bar" id="status-bar">
            Ready to start... Anna the Martopicker watches from the shadows ‚è∞
        </div>
        
        <!-- üéÆ Bouton d'ouverture du s√©lecteur de sc√©narios -->
        <button id="open-scenario-selector-btn" class="scenario-selector-btn">
            üéÆ Sc√©narios
        </button>

        <!-- Dicebear Gallery Modal -->
        <div id="dicebear-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üé≠ Dicebear Graphics Gallery</h2>
                    <span class="close" id="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="dicebear-gallery"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="api.js"></script>
    <script src="translation-service.js"></script>
    <script src="script-console.js"></script>
    <script src="game.js"></script>
    <script src="runic-forge.js"></script>
    <script src="temporal-integration.js"></script>
    <script src="hero-avatars.js"></script>
    <script src="fog-of-war-system.js"></script>
    <script src="scenario-selector.js"></script>
    <script src="gameplay-enhancement.js"></script>
    <script src="missing-assets-loader.js"></script>
    <script src="gameplay-construction.js"></script>
    <script src="dicebar-graphics-system.js"></script>
    <script>
        // Initialize the comprehensive dicebar graphics system
        const dicebarSystem = new DicebarGraphicsSystem();
        
        // Initialize game components
        let gameRenderer;
        let gameState = {
            heroes: [],
            creatures: [],
            artifacts: [],
            currentTimeline: '‚Ñ¨1',
            currentTurn: 0,
            decayStatus: 'None'
        };

        // Mock heroes with dicebar graphics
        window.createMockHeroes = function() {
            const mockHeroes = [
                {
                    name: 'Ragnar',
                    health: 120,
                    maxHealth: 120,
                    temporalEnergy: 80,
                    movementPoints: 3,
                    timeline: '‚Ñ¨1',
                    position: { q: 0, r: 0 }
                },
                {
                    name: 'Arthur',
                    health: 100,
                    maxHealth: 100,
                    temporalEnergy: 60,
                    movementPoints: 2,
                    timeline: '‚Ñ¨1',
                    position: { q: 1, r: -1 }
                },
                {
                    name: 'Jean-Grofignon',
                    health: 80,
                    maxHealth: 80,
                    temporalEnergy: 120,
                    movementPoints: 2,
                    timeline: '‚Ñ¨1',
                    position: { q: -1, r: 1 }
                }
            ];
            
            gameState.heroes = mockHeroes;
            window.updateHeroesList(mockHeroes);
            window.updateStatusBar('Demo Heroes: Ragnar üõ°Ô∏è, Arthur ‚öîÔ∏è, and Jean-Grofignon üß† ready with Dicebear graphics!');
        };

        // Enhanced heroes list with dicebar graphics
        window.updateHeroesList = function(heroes) {
            const heroesList = document.getElementById('heroes-list');
            if (!heroesList) return;
            
            heroesList.innerHTML = '';
            heroes.forEach(hero => {
                const heroElement = document.createElement('div');
                heroElement.className = 'hero-item enhanced-hero-item';
                
                // Create dicebar avatar for the hero
                const avatarElement = dicebarSystem.createAvatarElement('hero', hero.name, 50);
                
                heroElement.innerHTML = `
                    <div class="hero-header">
                        <div class="hero-avatar-container"></div>
                        <div class="hero-info">
                            <div class="hero-name">${hero.name}</div>
                            <div class="hero-stats">
                                <span class="health">‚ù§Ô∏è ${hero.health}/${hero.maxHealth}</span>
                                <span class="energy">‚ö° ${hero.temporalEnergy}</span>
                                <span class="movement">üëü ${hero.movementPoints}</span>
                            </div>
                        </div>
                    </div>
                    <div class="hero-timeline">‚è∞ ${hero.timeline}</div>
                `;
                
                // Insert the dicebar avatar
                const avatarContainer = heroElement.querySelector('.hero-avatar-container');
                avatarContainer.appendChild(avatarElement);
                
                heroesList.appendChild(heroElement);
            });
        };

        // Dicebear Gallery functionality
        document.getElementById('dicebear-gallery-btn').addEventListener('click', function() {
            const modal = document.getElementById('dicebear-modal');
            modal.style.display = 'block';
            
            // Create the gallery
            dicebarSystem.createAvatarGrid('dicebear-gallery');
        });

        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('dicebear-modal').style.display = 'none';
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('dicebear-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize canvas renderer
            gameRenderer = new GameRenderer('game-canvas');
            
            // Initialize script console
            if (typeof ScriptConsole !== 'undefined') {
                window.scriptConsole = new ScriptConsole('script-console');
                window.scriptConsole.addToOutput('üï∞Ô∏è Heroes of Time - Temporal Engine with Enhanced Dicebear Graphics', 'success');
                window.scriptConsole.addToOutput('Available commands:', 'normal');
                window.scriptConsole.addToOutput('  ‚Ä¢ HERO(Ragnar) - Create hero with dicebear avatar', 'normal');
                window.scriptConsole.addToOutput('  ‚Ä¢ MOV(Ragnar, @5,3) - Move hero', 'normal');
                window.scriptConsole.addToOutput('  ‚Ä¢ CREATURE(Dragon Rouge Temporel) - Summon creature with graphics', 'normal');
                window.scriptConsole.addToOutput('  ‚Ä¢ ARTIFACT(avantworld_blade) - Create artifact with graphics', 'normal');
                window.scriptConsole.addToOutput('üé≠ Click "Dicebear Gallery" to see all available graphics!', 'info');
            }

            // Load demo heroes with dicebar graphics
            setTimeout(() => {
                window.scriptConsole.addToOutput('üé≠ Loading heroes with dicebear graphics for immediate testing...', 'info');
                window.createMockHeroes();
            }, 1000);

            // Initialize other game systems
            if (typeof initializeGameSystems === 'function') {
                initializeGameSystems();
            }
        });

        // Enhanced button handlers with dicebar integration
        document.getElementById('new-game-btn').addEventListener('click', async function() {
            try {
                const result = await window.gameAPI.newGame();
                window.scriptConsole.addToOutput('üéÆ New game started with dicebear graphics!', 'success');
                window.createMockHeroes(); // Load heroes with graphics
            } catch (error) {
                window.scriptConsole.addToOutput('‚ö†Ô∏è Backend not available, using demo mode with graphics', 'warning');
                window.createMockHeroes();
            }
        });

        document.getElementById('add-ragnar-btn').addEventListener('click', async function() {
            try {
                const result = await window.gameAPI.executeScript('HERO(Ragnar)');
                window.scriptConsole.addToOutput('üõ°Ô∏è Hero Ragnar created with dicebear graphics via temporal script!', 'success');
                window.updateHeroesList(result.heroes || []);
            } catch (error) {
                window.scriptConsole.addToOutput('‚ö†Ô∏è Backend not available for script execution', 'warning');
                window.scriptConsole.addToOutput('üé≠ Loading demo heroes with graphics instead...', 'info');
                window.createMockHeroes();
            }
        });

        document.getElementById('test-decay-btn').addEventListener('click', async function() {
            try {
                const result = await window.gameAPI.testDecay();
                window.scriptConsole.addToOutput('‚è∞ Temporal decay test executed', 'success');
                if (result.decayStatus) {
                    document.getElementById('decay-status').textContent = `Decay: ${result.decayStatus}`;
                }
            } catch (error) {
                window.scriptConsole.addToOutput('‚ö†Ô∏è Backend not available for decay testing', 'warning');
                document.getElementById('decay-status').textContent = 'Decay: Demo Mode';
            }
        });

        // Status bar update function
        window.updateStatusBar = function(message) {
            if (window.scriptConsole) {
                window.scriptConsole.addToOutput(message, 'info');
            }
        };

        // Global game state access
        window.getGameState = function() {
            return gameState;
        };

        window.updateGameState = function(newState) {
            gameState = { ...gameState, ...newState };
            if (gameRenderer) {
                gameRenderer.updateGameState(gameState);
            }
        };

        // Export dicebar system for global access
        window.dicebarSystem = dicebarSystem;
    </script>
</body>
</html>