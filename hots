#!/bin/bash

# Heroes of Time - Script de contrÃ´le principal
# Usage: ./hots [start|stop|status|restart|test|help]

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SERVICES_SCRIPT="$SCRIPT_DIR/scripts/actifs/start-services-background.sh"
STOP_SCRIPT="$SCRIPT_DIR/scripts/actifs/stop-all-services.sh"

# Couleurs pour l'affichage
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

show_help() {
    echo -e "${CYAN}ğŸ® Heroes of Time - ContrÃ´le des services${NC}"
    echo -e "${CYAN}=========================================${NC}"
    echo ""
    echo -e "${GREEN}Usage:${NC} ./hots [commande] [options]"
    echo ""
    echo -e "${YELLOW}Commandes disponibles:${NC}"
    echo -e "  ${GREEN}start${NC}       DÃ©marre tous les services en arriÃ¨re-plan"
    echo -e "  ${GREEN}stop${NC}        ArrÃªte tous les services"
    echo -e "  ${GREEN}restart${NC}     RedÃ©marre tous les services"
    echo -e "  ${GREEN}status${NC}      Affiche le statut des services"
    echo -e "  ${GREEN}test${NC}        Lance les tests (voir options ci-dessous)"
    echo -e "  ${GREEN}help${NC}        Affiche cette aide"
    echo ""
    echo -e "${YELLOW}Options de test:${NC}"
    echo -e "  ${GREEN}./hots test${NC}              Tests complets (dÃ©faut)"
    echo -e "  ${GREEN}./hots test quick${NC}        Tests rapides (1-2 min)"
    echo -e "  ${GREEN}./hots test ui${NC}           Tests interfaces utilisateur"
    echo -e "  ${GREEN}./hots test backend${NC}      Tests backend uniquement"
    echo -e "  ${GREEN}./hots test maven${NC}        Tests Maven compilation/build"
    echo -e "  ${GREEN}./hots test demo${NC}         DÃ©monstrations interactives"
    echo -e "  ${GREEN}./hots test bataille${NC}     Tests bataille temporelle"
    echo -e "  ${GREEN}./hots test quantum${NC}      Tests quantum/visualiseurs"
    echo -e "  ${GREEN}./hots test scenarios${NC}    Tests scÃ©narios HOTS complets"
    echo -e "  ${GREEN}./hots test performance${NC}  Tests de performance"
    echo -e "  ${GREEN}./hots test integration${NC}  Tests d'intÃ©gration complÃ¨te"
    echo -e "  ${GREEN}./hots test report${NC}       Rapport complet des tests"
    echo -e "  ${GREEN}./hots test final${NC}        ğŸ† TOUS LES TESTS (complet)"
    echo -e "  ${GREEN}./hots test list${NC}         Liste tous les tests disponibles"
    echo ""
    echo -e "${YELLOW}Exemples:${NC}"
    echo -e "  ${CYAN}./hots start${NC}             # DÃ©marre tout"
    echo -e "  ${CYAN}./hots status${NC}            # VÃ©rifie l'Ã©tat"
    echo -e "  ${CYAN}./hots test quick${NC}        # Tests rapides"
    echo -e "  ${CYAN}./hots test maven${NC}        # Test compilation backend"
    echo -e "  ${CYAN}./hots test final${NC}        # ğŸ† TEST COMPLET FINAL"
    echo -e "  ${CYAN}./hots test report${NC}       # Rapport dÃ©taillÃ©"
}

check_services() {
    local services_found=0
    
    # VÃ©rifier chaque port
    if lsof -i :9000 >/dev/null 2>&1; then
        echo -e "  âœ… Dashboard (9000) - ACTIF"
        ((services_found++))
    else
        echo -e "  âŒ Dashboard (9000) - ARRÃŠTÃ‰"
    fi
    
    if lsof -i :8000 >/dev/null 2>&1; then
        echo -e "  âœ… Frontend (8000) - ACTIF"
        ((services_found++))
    else
        echo -e "  âŒ Frontend (8000) - ARRÃŠTÃ‰"
    fi
    
    if lsof -i :8080 >/dev/null 2>&1; then
        echo -e "  âœ… Backend API (8080) - ACTIF"
        ((services_found++))
    else
        echo -e "  âŒ Backend API (8080) - ARRÃŠTÃ‰"
    fi
    
    if lsof -i :5174 >/dev/null 2>&1; then
        echo -e "  âœ… Temporal (5174) - ACTIF"
        ((services_found++))
    else
        echo -e "  âŒ Temporal (5174) - ARRÃŠTÃ‰"
    fi
    
    if lsof -i :8001 >/dev/null 2>&1; then
        echo -e "  âœ… Quantum (8001) - ACTIF"
        ((services_found++))
    else
        echo -e "  âŒ Quantum (8001) - ARRÃŠTÃ‰"
    fi
    
    if lsof -i :5175 >/dev/null 2>&1; then
        echo -e "  âœ… Visualizer (5175) - ACTIF"
        ((services_found++))
    else
        echo -e "  âŒ Visualizer (5175) - ARRÃŠTÃ‰"
    fi
    
    if lsof -i :8888 >/dev/null 2>&1; then
        echo -e "  âœ… Test Runner (8888) - ACTIF"
        ((services_found++))
    else
        echo -e "  âŒ Test Runner (8888) - ARRÃŠTÃ‰"
    fi
    
    return $services_found
}

show_status() {
    echo -e "${BLUE}ğŸ” Statut des services Heroes of Time${NC}"
    echo "===================================="
    check_services
    local active_services=$?
    
    echo ""
    echo "URLs d'accÃ¨s:"
    echo -e "  ğŸ¯ Dashboard: ${CYAN}http://localhost:9000/dashboard.html${NC}"
    echo -e "  ğŸ“Š Frontend: ${CYAN}http://localhost:8000${NC}"
    echo -e "  âš™ï¸ Backend API: ${CYAN}http://localhost:8080/api/health${NC}"
    echo -e "  âš”ï¸ Temporal: ${CYAN}http://localhost:5174${NC}"
    echo -e "  ğŸŒŒ Quantum: ${CYAN}http://localhost:8001${NC}"
    echo -e "  ğŸ”® Visualizer: ${CYAN}http://localhost:5175${NC}"
    echo -e "  ğŸ§ª Test Runner: ${CYAN}http://localhost:8888${NC}"
    
    echo ""
    if [ $active_services -eq 6 ]; then
        echo -e "${GREEN}âœ… Tous les services sont actifs !${NC}"
    elif [ $active_services -gt 3 ]; then
        echo -e "${YELLOW}âš ï¸  $active_services/6 services actifs${NC}"
    else
        echo -e "${RED}âŒ Seulement $active_services/6 services actifs${NC}"
    fi
}

start_services() {
    echo -e "${BLUE}ğŸš€ DÃ©marrage des services Heroes of Time${NC}"
    echo "========================================"
    
    if [ -f "$SERVICES_SCRIPT" ]; then
        bash "$SERVICES_SCRIPT"
        echo ""
        echo -e "${GREEN}âœ… Services lancÃ©s en arriÃ¨re-plan${NC}"
        echo -e "${YELLOW}ğŸ’¡ Utilisez './hots status' pour vÃ©rifier l'Ã©tat${NC}"
    else
        echo -e "${RED}âŒ Script de dÃ©marrage non trouvÃ©: $SERVICES_SCRIPT${NC}"
        return 1
    fi
}

stop_services() {
    echo -e "${BLUE}ğŸ›‘ ArrÃªt des services Heroes of Time${NC}"
    echo "====================================="
    
    if [ -f "$STOP_SCRIPT" ]; then
        bash "$STOP_SCRIPT"
        echo ""
        echo -e "${GREEN}âœ… Services arrÃªtÃ©s${NC}"
    else
        echo -e "${RED}âŒ Script d'arrÃªt non trouvÃ©: $STOP_SCRIPT${NC}"
        return 1
    fi
}

restart_services() {
    echo -e "${BLUE}ğŸ”„ RedÃ©marrage des services Heroes of Time${NC}"
    echo "=========================================="
    stop_services
    sleep 2
    start_services
}

# Nouvelles fonctions de test
list_available_tests() {
    echo -e "${CYAN}ğŸ“‹ Tests disponibles dans Heroes of Time${NC}"
    echo -e "${CYAN}=======================================${NC}"
    echo ""
    echo -e "${YELLOW}ğŸ”§ Tests de base:${NC}"
    echo -e "  ${GREEN}quick${NC}         - Tests rapides (1-2 min)"
    echo -e "  ${GREEN}ui${NC}            - Tests interfaces utilisateur"
    echo -e "  ${GREEN}backend${NC}       - Tests backend uniquement"
    echo -e "  ${GREEN}maven${NC}         - Tests Maven compilation/build"
    echo ""
    echo -e "${YELLOW}ğŸ® Tests spÃ©cialisÃ©s:${NC}"
    echo -e "  ${GREEN}demo${NC}          - DÃ©monstrations interactives"
    echo -e "  ${GREEN}bataille${NC}      - Tests bataille temporelle"
    echo -e "  ${GREEN}quantum${NC}       - Tests quantum/visualiseurs"
    echo -e "  ${GREEN}scenarios${NC}     - Tests scÃ©narios HOTS complets"
    echo -e "  ${GREEN}performance${NC}   - Tests de performance et optimisation"
    echo -e "  ${GREEN}integration${NC}   - Tests d'intÃ©gration complÃ¨te"
    echo ""
    echo -e "${YELLOW}ğŸ“Š Rapports et analyse:${NC}"
    echo -e "  ${GREEN}report${NC}        - Rapport complet des tests"
    echo -e "  ${GREEN}final${NC}         - Test final complet (tous les tests)"
    echo -e "  ${GREEN}list${NC}          - Cette liste"
    echo ""
    echo -e "${YELLOW}ğŸ“ Scripts de test disponibles:${NC}"
    
    # Lister les scripts de test disponibles
    if [ -d "scripts/test" ]; then
        find scripts/test -name "*.sh" | sort | while read script; do
            echo -e "  ğŸ“„ ${BLUE}$script${NC}"
        done
    fi
    
    if [ -d "scripts/demo" ]; then
        echo ""
        echo -e "${YELLOW}ğŸ¬ Scripts de dÃ©mo disponibles:${NC}"
        find scripts/demo -name "*.sh" | sort | while read script; do
            echo -e "  ğŸ­ ${PURPLE}$script${NC}"
        done
    fi
}

run_test_suite() {
    local test_type="${1:-complete}"
    
    echo -e "${CYAN}ğŸ§ª Lancement des tests Heroes of Time${NC}"
    echo -e "${CYAN}====================================${NC}"
    echo -e "${YELLOW}Type de test: ${test_type}${NC}"
    echo ""
    
    case "$test_type" in
        "quick")
            echo -e "${GREEN}ğŸš€ Tests rapides en cours...${NC}"
            if [ -f "scripts/test/test-ui-quick.sh" ]; then
                bash scripts/test/test-ui-quick.sh
            elif [ -f "scripts/actifs/test-ui-quick.sh" ]; then
                bash scripts/actifs/test-ui-quick.sh
            else
                echo -e "${RED}âŒ Script de test rapide non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "ui")
            echo -e "${GREEN}ğŸ–¥ï¸  Tests d'interface utilisateur...${NC}"
            if [ -f "scripts/test/test-scenarios-ui.sh" ]; then
                bash scripts/test/test-scenarios-ui.sh
            else
                echo -e "${RED}âŒ Script de test UI non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "backend")
            echo -e "${GREEN}âš™ï¸  Tests backend...${NC}"
            if [ -f "scripts/test/test-backend-conformity.sh" ]; then
                bash scripts/test/test-backend-conformity.sh
            else
                echo -e "${RED}âŒ Script de test backend non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "maven")
            echo -e "${GREEN}â˜• Tests Maven compilation...${NC}"
            echo -e "${YELLOW}ğŸ”§ Test compilation backend Maven...${NC}"
            if [ -d "backend" ]; then
                cd backend
                echo "ğŸ“‹ Tentative de compilation Maven..."
                if mvn clean compile -q; then
                    echo -e "${GREEN}âœ… Compilation Maven rÃ©ussie${NC}"
                else
                    echo -e "${RED}âŒ Erreur de compilation Maven${NC}"
                    echo -e "${YELLOW}ğŸ’¡ ProblÃ¨mes connus: executeFormula manquante, JPA entities${NC}"
                fi
                cd ..
            else
                echo -e "${RED}âŒ Dossier backend non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "demo")
            echo -e "${GREEN}ğŸ¬ DÃ©monstrations interactives...${NC}"
            if [ -f "scripts/demo/demo-quantum-final.sh" ]; then
                bash scripts/demo/demo-quantum-final.sh
            else
                echo -e "${RED}âŒ Script de dÃ©mo non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "bataille")
            echo -e "${GREEN}âš”ï¸  Tests bataille temporelle...${NC}"
            if [ -f "scripts/test/test-complete-bataille-temporelle.sh" ]; then
                bash scripts/test/test-complete-bataille-temporelle.sh
            else
                echo -e "${RED}âŒ Script de test bataille non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "quantum")
            echo -e "${GREEN}ğŸŒ€ Tests quantum et visualiseurs...${NC}"
            if [ -f "tester-quantum-ui.sh" ]; then
                bash tester-quantum-ui.sh
            else
                echo -e "${RED}âŒ Script de test quantum non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "scenarios")
            echo -e "${GREEN}ğŸ­ Tests scÃ©narios HOTS...${NC}"
            if [ -f "scripts/test/run-all-hots-scenarios.sh" ]; then
                bash scripts/test/run-all-hots-scenarios.sh
            else
                echo -e "${RED}âŒ Script de test scÃ©narios non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "performance")
            echo -e "${GREEN}âš¡ Tests de performance...${NC}"
            if [ -f "scripts/test/test-optimizations-performance.sh" ]; then
                bash scripts/test/test-optimizations-performance.sh
            elif [ -f "scripts/test/benchmark-native-vs-script.sh" ]; then
                bash scripts/test/benchmark-native-vs-script.sh
            else
                echo -e "${RED}âŒ Script de test performance non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "integration")
            echo -e "${GREEN}ğŸ”— Tests d'intÃ©gration...${NC}"
            if [ -f "scripts/test/test-integration-complete.sh" ]; then
                bash scripts/test/test-integration-complete.sh
            else
                echo -e "${RED}âŒ Script de test intÃ©gration non trouvÃ©${NC}"
                return 1
            fi
            ;;
        "report")
            generate_test_report
            ;;
        "final")
            echo -e "${GREEN}ğŸ† TEST FINAL COMPLET - TOUS LES TESTS${NC}"
            echo -e "${CYAN}=====================================${NC}"
            
            # Lancer tous les tests dans l'ordre
            echo -e "${YELLOW}ğŸš€ Phase 1: Tests rapides${NC}"
            run_test_suite "quick"
            
            echo -e "${YELLOW}ğŸ–¥ï¸  Phase 2: Tests UI${NC}"
            run_test_suite "ui"
            
            echo -e "${YELLOW}âš™ï¸  Phase 3: Tests backend${NC}"
            run_test_suite "backend"
            
            echo -e "${YELLOW}â˜• Phase 4: Tests Maven${NC}"
            run_test_suite "maven"
            
            echo -e "${YELLOW}ğŸ¬ Phase 5: DÃ©monstrations${NC}"
            run_test_suite "demo"
            
            echo -e "${YELLOW}âš”ï¸  Phase 6: Tests bataille${NC}"
            run_test_suite "bataille"
            
            echo -e "${YELLOW}ğŸŒ€ Phase 7: Tests quantum${NC}"
            run_test_suite "quantum"
            
            echo -e "${YELLOW}ğŸ­ Phase 8: Tests scÃ©narios${NC}"
            run_test_suite "scenarios"
            
            echo -e "${YELLOW}âš¡ Phase 9: Tests performance${NC}"
            run_test_suite "performance"
            
            echo -e "${YELLOW}ğŸ”— Phase 10: Tests intÃ©gration${NC}"
            run_test_suite "integration"
            
            echo ""
            echo -e "${CYAN}ğŸ† TEST FINAL COMPLET TERMINÃ‰${NC}"
            echo -e "${GREEN}âœ… Toutes les phases de test exÃ©cutÃ©es${NC}"
            
            # Rapport final
            generate_test_report
            ;;
        "list")
            list_available_tests
            ;;
        "complete"|*)
            echo -e "${GREEN}ğŸ”¬ Tests complets en cours...${NC}"
            if [ -f "scripts/test/test-complet-final.sh" ]; then
                bash scripts/test/test-complet-final.sh
            elif [ -f "test-complet-final.sh" ]; then
                bash test-complet-final.sh
            else
                echo -e "${RED}âŒ Script de test complet non trouvÃ©${NC}"
                return 1
            fi
            ;;
    esac
}

generate_test_report() {
    echo -e "${CYAN}ğŸ“Š Rapport complet des tests Heroes of Time${NC}"
    echo -e "${CYAN}===========================================${NC}"
    echo ""
    
    # VÃ©rifier l'Ã©tat des services
    echo -e "${YELLOW}ğŸ” Ã‰tat des services:${NC}"
    check_services
    local active_services=$?
    echo ""
    
    # VÃ©rifier le Test Runner
    echo -e "${YELLOW}ğŸ§ª Test Runner Analysis:${NC}"
    if lsof -i :8888 >/dev/null 2>&1; then
        echo -e "  âœ… Test Runner actif sur port 8888"
        echo -e "  ğŸŒ Interface: ${CYAN}http://localhost:8888${NC}"
        
        # Analyser les tests disponibles dans le Test Runner
        if [ -f "test-runner-interface.html" ]; then
            echo -e "  ğŸ“‹ Interface HTML: ${GREEN}Disponible${NC}"
            
            # Extraire les tests configurÃ©s
            echo -e "  ğŸ¯ Tests configurÃ©s dans l'interface:"
            grep -o "script: '[^']*'" test-runner-interface.html 2>/dev/null | sed "s/script: '/    ğŸ“„ /" | sed "s/'$//"
        fi
        
        if [ -f "test-runner-server.py" ]; then
            echo -e "  ğŸ Serveur Python: ${GREEN}Disponible${NC}"
        fi
    else
        echo -e "  âŒ Test Runner non actif"
    fi
    echo ""
    
    # Analyser les scripts de test disponibles
    echo -e "${YELLOW}ğŸ“ Scripts de test disponibles:${NC}"
    local test_count=0
    
    if [ -d "scripts/test" ]; then
        while IFS= read -r script; do
            if [ -f "$script" ]; then
                local size=$(du -h "$script" 2>/dev/null | cut -f1)
                local name=$(basename "$script")
                echo -e "  ğŸ“„ ${GREEN}$name${NC} (${size})"
                ((test_count++))
            fi
        done < <(find scripts/test -name "*.sh" | sort)
    fi
    
    if [ -d "scripts/demo" ]; then
        echo ""
        echo -e "${YELLOW}ğŸ¬ Scripts de dÃ©mo disponibles:${NC}"
        while IFS= read -r script; do
            if [ -f "$script" ]; then
                local size=$(du -h "$script" 2>/dev/null | cut -f1)
                local name=$(basename "$script")
                echo -e "  ğŸ­ ${PURPLE}$name${NC} (${size})"
                ((test_count++))
            fi
        done < <(find scripts/demo -name "*.sh" | sort)
    fi
    
    echo ""
    echo -e "${YELLOW}ğŸ” Tests racine disponibles:${NC}"
    for script in test-*.sh tester-*.sh; do
        if [ -f "$script" ]; then
            local size=$(du -h "$script" 2>/dev/null | cut -f1)
            echo -e "  ğŸ§ª ${BLUE}$script${NC} (${size})"
            ((test_count++))
        fi
    done
    
    # Analyser le backend Maven
    echo ""
    echo -e "${YELLOW}â˜• Analyse Backend Maven:${NC}"
    if [ -f "backend/pom.xml" ]; then
        echo -e "  ğŸ“„ pom.xml: ${GREEN}Disponible${NC}"
        if [ -d "backend/src/main/java" ]; then
            local java_files=$(find backend/src/main/java -name "*.java" | wc -l)
            echo -e "  â˜• Fichiers Java: ${GREEN}$java_files fichiers${NC}"
        fi
        if [ -d "backend/target" ]; then
            echo -e "  ğŸ¯ Target Maven: ${GREEN}PrÃ©sent${NC}"
        else
            echo -e "  ğŸ¯ Target Maven: ${YELLOW}Absent (pas compilÃ©)${NC}"
        fi
        
        # Test de compilation rapide
        echo -e "  ğŸ”§ Test compilation rapide..."
        if (cd backend && mvn compile -q >/dev/null 2>&1); then
            echo -e "  âœ… Compilation: ${GREEN}RÃ©ussie${NC}"
        else
            echo -e "  âŒ Compilation: ${RED}Ã‰choue${NC}"
            echo -e "    ğŸ’¡ ProblÃ¨mes connus: executeFormula manquante, JPA entities"
        fi
    else
        echo -e "  âŒ Backend Maven non trouvÃ©"
    fi
    
    # Analyser les frontends
    echo ""
    echo -e "${YELLOW}ğŸ–¥ï¸  Analyse Frontends:${NC}"
    local frontend_count=0
    for frontend_dir in frontend frontend-temporal frontend-legendary-ui quantum-visualizer; do
        if [ -d "$frontend_dir" ] && [ -f "$frontend_dir/index.html" ]; then
            local size=$(du -sh "$frontend_dir" 2>/dev/null | cut -f1)
            echo -e "  ğŸ“ ${GREEN}$frontend_dir${NC} (${size})"
            ((frontend_count++))
        fi
    done
    echo -e "  ğŸ“Š Total frontends: ${GREEN}$frontend_count${NC}"
    
    # Analyser les scÃ©narios et assets
    echo ""
    echo -e "${YELLOW}ğŸ­ Analyse ScÃ©narios et Assets:${NC}"
    if [ -d "game_assets/scenarios" ]; then
        local hots_files=$(find game_assets/scenarios -name "*.hots" | wc -l)
        local json_files=$(find game_assets/scenarios -name "*.json" | wc -l)
        echo -e "  ğŸ“„ Fichiers HOTS: ${GREEN}$hots_files${NC}"
        echo -e "  ğŸ“„ Fichiers JSON: ${GREEN}$json_files${NC}"
    else
        echo -e "  âŒ Dossier game_assets/scenarios non trouvÃ©"
    fi
    
    echo ""
    echo -e "${YELLOW}ğŸ“Š RÃ©sumÃ© du rapport:${NC}"
    echo -e "  ğŸ® Services actifs: ${GREEN}$active_services/6${NC}"
    echo -e "  ğŸ§ª Scripts de test: ${GREEN}$test_count${NC}"
    echo -e "  ğŸ–¥ï¸  Frontends: ${GREEN}$frontend_count${NC}"
    echo -e "  ğŸŒ Test Runner: $(if lsof -i :8888 >/dev/null 2>&1; then echo -e "${GREEN}Actif${NC}"; else echo -e "${RED}Inactif${NC}"; fi)"
    echo -e "  â˜• Backend Maven: $(if [ -f "backend/pom.xml" ]; then echo -e "${GREEN}Disponible${NC}"; else echo -e "${RED}Manquant${NC}"; fi)"
    
    # Ã‰tat de santÃ© global
    echo ""
    echo -e "${YELLOW}ğŸ¥ Ã‰tat de santÃ© global:${NC}"
    local health_score=0
    
    if [ $active_services -ge 4 ]; then ((health_score += 25)); fi
    if [ $test_count -ge 20 ]; then ((health_score += 25)); fi
    if lsof -i :8888 >/dev/null 2>&1; then ((health_score += 25)); fi
    if [ -f "backend/pom.xml" ]; then ((health_score += 25)); fi
    
    if [ $health_score -ge 90 ]; then
        echo -e "  ğŸŸ¢ ${GREEN}Excellent${NC} ($health_score/100)"
    elif [ $health_score -ge 70 ]; then
        echo -e "  ğŸŸ¡ ${YELLOW}Bon${NC} ($health_score/100)"
    elif [ $health_score -ge 50 ]; then
        echo -e "  ğŸŸ  ${YELLOW}Moyen${NC} ($health_score/100)"
    else
        echo -e "  ğŸ”´ ${RED}NÃ©cessite attention${NC} ($health_score/100)"
    fi
    
    # Recommandations
    echo ""
    echo -e "${YELLOW}ğŸ’¡ Recommandations:${NC}"
    
    if [ $active_services -lt 6 ]; then
        echo -e "  âš ï¸  DÃ©marrer tous les services: ${CYAN}./hots start${NC}"
    fi
    
    if ! lsof -i :8888 >/dev/null 2>&1; then
        echo -e "  ğŸ§ª Lancer le Test Runner: ${CYAN}python3 test-runner-server.py 8888 &${NC}"
    fi
    
    if [ -f "backend/pom.xml" ] && ! (cd backend && mvn compile -q >/dev/null 2>&1); then
        echo -e "  ğŸ”§ RÃ©parer backend Maven: ${CYAN}./hots test maven${NC}"
    fi
    
    echo -e "  ğŸš€ Tests rapides: ${CYAN}./hots test quick${NC}"
    echo -e "  ğŸ¬ DÃ©monstration: ${CYAN}./hots test demo${NC}"
    echo -e "  ğŸ† Test final complet: ${CYAN}./hots test final${NC}"
    echo -e "  ğŸ“‹ Liste complÃ¨te: ${CYAN}./hots test list${NC}"
    
    echo ""
    echo -e "${CYAN}ğŸ“ˆ Pour un diagnostic complet, utilisez: ${GREEN}./hots test final${NC}"
}

# Fonction principale
case "${1:-help}" in
    "start")
        start_services
        ;;
    "stop")
        stop_services
        ;;
    "restart")
        restart_services
        ;;
    "status")
        show_status
        ;;
    "test")
        run_test_suite "$2"
        ;;
    "help"|*)
        show_help
        ;;
esac 